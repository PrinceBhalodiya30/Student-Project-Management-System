generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Document {
  id         String   @id
  projectId  String
  name       String
  url        String
  type       String
  uploadedAt DateTime @default(now())
  Project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model FacultyProfile {
  id          String    @id
  userId      String    @unique
  department  String
  designation String
  expertise   String[]
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  Project     Project[]
}


model Meeting {
  id        String              @id @default(cuid())
  projectId String
  title     String
  date      DateTime
  minutes   String?
  createdAt DateTime            @default(now())
  Project   Project             @relation(fields: [projectId], references: [id], onDelete: Cascade)
  Attendance MeetingAttendance[]
}

model MeetingAttendance {
  id        String   @id @default(cuid())
  meetingId String
  studentId String
  isPresent Boolean  @default(false)
  remarks   String?
  Meeting   Meeting  @relation(fields: [meetingId], references: [id], onDelete: Cascade)
  Student   StudentProfile @relation(fields: [studentId], references: [id], onDelete: Cascade)
}

model Message {
  id        String   @id
  senderId  String
  content   String
  createdAt DateTime @default(now())
  User      User     @relation(fields: [senderId], references: [id], onDelete: Cascade)
}

model Milestone {
  id          String   @id
  projectId   String
  title       String
  deadline    DateTime
  isCompleted Boolean  @default(false)
  Project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Notification {
  id        String   @id
  userId    String
  title     String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Project {
  id             String          @id @default(cuid())
  title          String
  description    String
  typeId         String
  Type           ProjectType     @relation(fields: [typeId], references: [id])
  status         ProjectStatus   @default(PROPOSED)
  groupId        String          @unique
  guideId        String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  Document       Document[]
  Meeting        Meeting[]
  Milestone      Milestone[]
  ProjectGroup   ProjectGroup    @relation(fields: [groupId], references: [id])
  FacultyProfile FacultyProfile? @relation(fields: [guideId], references: [id], onDelete: SetNull)
}

model ProjectType {
  id          String    @id @default(cuid())
  name        String    @unique
  description String?
  Project     Project[]
}

model ProjectGroup {
  id             String           @id
  name           String
  createdAt      DateTime         @default(now())
  Project        Project?
  StudentProfile StudentProfile[]
}

model StudentProfile {
  id           String        @id
  userId       String        @unique
  idNumber     String        @unique
  department   String
  batch        String
  groupId      String?
  ProjectGroup ProjectGroup? @relation(fields: [groupId], references: [id])
  User         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  Attendance   MeetingAttendance[]
  isLeader     Boolean       @default(false)
}

model User {
  id             String          @id
  email          String          @unique
  password       String
  fullName       String
  role           Role            @default(STUDENT)
  avatarUrl      String?
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  FacultyProfile FacultyProfile?
  Message        Message[]
  Notification   Notification[]
  StudentProfile StudentProfile?
}

enum ProjectStatus {
  PROPOSED
  APPROVED
  IN_PROGRESS
  COMPLETED
  REJECTED
}

enum Role {
  ADMIN
  FACULTY
  STUDENT
}

model Department {
  id        String   @id @default(cuid())
  name      String   @unique
  code      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AcademicYear {
  id        String   @id @default(cuid())
  name      String   @unique // e.g., "2023-2024"
  slug      String   @unique // e.g., "2023-24"
  startDate DateTime
  endDate   DateTime
  isCurrent Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
